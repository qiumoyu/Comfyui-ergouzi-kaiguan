# ComfyUI全局组条件控制节点使用指南

## 🎯 功能概述

全局组条件控制节点（全局组条件控制🌐🔀）是专为ComfyUI设计的智能工作流控制系统，它可以根据条件判断自动控制节点组的开关状态。

### 核心功能
- 🧠 **智能条件判断**：支持8种比较类型，自动数据类型识别
- 🎛️ **组状态控制**：控制节点组的启用/禁用/屏蔽状态  
- 🌐 **全局管理**：可同时控制多个组或所有组
- 📊 **状态监控**：实时监控和管理组控制状态

## 📖 ComfyUI节点状态说明

在ComfyUI中，每个节点有三种运行状态：

1. **启用（正常）**：节点正常执行，参与工作流
2. **禁用（关闭）**：节点完全关闭，不参与工作流，数据流中断
3. **屏蔽（跳过）**：节点被跳过，但数据会直接传递给下一个节点

## 🔧 节点类型

### 1. 全局组条件控制🌐🔀

**主要功能**：根据条件判断自动控制组状态

#### 参数说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| enable | 布尔值 | True | 节点总开关 |
| input_value | 任意类型 | - | 用于条件判断的输入值 |
| comparison_type | 下拉选择 | 等于 | 比较类型：等于、不等于、大于、小于、大于等于、小于等于、包含、不包含 |
| comparison_value | 字符串 | "" | 比较的参考值 |
| when_true | 下拉选择 | 启用组 | 条件为真时的动作：启用组/禁用组/屏蔽组/不变 |
| when_false | 下拉选择 | 禁用组 | 条件为假时的动作：启用组/禁用组/屏蔽组/不变 |
| target_groups | 多行文本 | "" | 目标组名列表（每行一个，留空=所有组） |
| reverse_condition | 布尔值 | False | 是否反转条件判断结果 |

#### 输出

1. **输出**：原始输入值的传递
2. **条件结果**：条件判断的布尔结果
3. **执行动作**：当前执行的控制动作
4. **受控组列表**：受控制的组名列表

### 2. 智能组开关🎯

**主要功能**：简化的组开关控制，直接设置组状态

#### 参数说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| enable_group | 布尔值 | True | 是否启用组控制 |
| group_names | 多行文本 | "" | 要控制的组名（每行一个，留空=所有组） |
| switch_mode | 下拉选择 | 开启 | 开关模式：开启/关闭/屏蔽 |

## 💡 实际应用场景

### 场景1：根据Prompt长度优化性能

```yaml
# 设置说明
输入值: prompt文本
比较类型: 大于
比较值: "100"
条件为真: 启用组  # 长prompt启用高质量处理
条件为假: 屏蔽组  # 短prompt跳过高质量处理
目标组: |
  高质量采样组
  超分辨率组
```

**效果**：当prompt长度超过100字符时，启用高质量处理组；否则跳过以提升速度。

### 场景2：根据图像尺寸选择处理策略

```yaml
输入值: 图像宽度
比较类型: 大于等于  
比较值: "1024"
条件为真: 启用组  # 大图启用高分辨率处理
条件为假: 禁用组  # 小图禁用高分辨率处理
目标组: |
  高分辨率处理组
  内存优化组
```

### 场景3：内容安全控制

```yaml
输入值: prompt文本
比较类型: 包含
比较值: "NSFW"
条件为真: 禁用组  # 包含敏感词时禁用生成
条件为假: 启用组  # 正常内容启用生成
目标组: |
  图像生成组
  后处理组
```

### 场景4：质量评分控制

```yaml
输入值: 质量评分
比较类型: 小于
比较值: "0.7"
条件为真: 屏蔽组  # 低质量跳过后处理
条件为假: 启用组  # 高质量启用后处理
目标组: 美化后处理组
```

## 🎮 使用步骤

### 基础使用

1. **添加节点**：在ComfyUI节点菜单中找到"2🐕kaiguan"分类
2. **选择节点**：添加"全局组条件控制🌐🔀"或"智能组开关🎯"
3. **连接输入**：将需要判断的数据连接到input_value
4. **设置条件**：配置比较类型和比较值
5. **选择动作**：设置条件为真/假时的动作
6. **指定目标**：输入要控制的组名（留空=所有组）

### 高级功能

#### 右键菜单功能

- **🌐 控制面板**：查看和管理组控制状态
- **🔄 立即执行**：手动触发控制逻辑
- **🧹 清理状态**：重置组状态到原始状态

#### 控制面板功能

- **📊 状态监控**：查看活跃控制器和受控组数量
- **🎛️ 组状态列表**：实时显示每个组的控制状态
- **⚡ 快速控制**：一键控制所有组
  - 🟢 全部启用
  - 🟡 全部屏蔽
  - 🔴 全部禁用
  - 🔄 恢复原状

## ⚡ 最佳实践

### 1. 组织节点组

```
推荐的组组织方式：

📁 预处理组
├── 图像预处理节点
├── 文本编码节点
└── 参数设置节点

📁 主生成组
├── 采样器节点
├── 模型节点
└── VAE节点

📁 后处理组
├── 超分辨率节点
├── 面部修复节点
└── 色彩调整节点

📁 输出组
├── 图像保存节点
└── 预览节点
```

### 2. 条件设计技巧

- **数值比较**：使用具体数字，如"1024"而不是"大"
- **字符串匹配**：注意大小写，可使用"包含"做模糊匹配
- **布尔逻辑**：善用"反转条件"实现复杂逻辑

### 3. 性能优化

- **精确控制**：指定具体组名，避免不必要的全局控制
- **状态管理**：定期使用"恢复原状"清理状态
- **避免冲突**：同一组避免被多个控制节点同时控制

### 4. 调试技巧

- **查看控制台**：观察调试输出了解控制过程
- **使用面板**：通过控制面板监控状态变化
- **分步测试**：先测试条件判断，再测试组控制

## 🚨 常见问题

### Q1: 组控制不生效？
**解决方案**：
1. 检查节点的`enable`参数是否为True
2. 确认组名是否正确（区分大小写）
3. 查看控制台输出的调试信息
4. 使用控制面板检查组状态

### Q2: 条件判断错误？
**解决方案**：
1. 检查输入值和比较值的数据类型
2. 对于数值比较，确保格式正确
3. 字符串比较注意空格和大小写
4. 尝试使用"反转条件"

### Q3: 多个控制节点冲突？
**解决方案**：
1. 避免多个节点控制同一组
2. 使用控制面板查看冲突状态
3. 必要时使用"清理状态"重置

### Q4: 性能影响？
**解决方案**：
1. 指定具体组名，避免全局控制
2. 定期清理无用的控制状态
3. 合理设置条件判断频率

## 🔧 技术实现

### 状态管理机制

```javascript
// 组状态映射
LiteGraph.ALWAYS = 0;  // 启用（正常执行）
LiteGraph.NEVER = 1;   // 禁用（完全关闭）
LiteGraph.BYPASS = 4;  // 屏蔽（跳过执行）
```

### 控制流程

1. **条件评估** → 2. **动作选择** → 3. **组筛选** → 4. **状态应用** → 5. **画布刷新**

## 🎉 总结

全局组条件控制节点为ComfyUI提供了强大的智能化工作流控制能力：

- ✅ **自动化**：根据条件自动调整工作流
- ✅ **高效性**：通过组控制提升性能
- ✅ **灵活性**：支持复杂的条件逻辑
- ✅ **可视化**：直观的状态管理界面

通过合理使用这些节点，可以构建出高度智能和自适应的ComfyUI工作流！

---

**开发者**: 灵仙儿和二狗子  
**项目**: [Comfyui-ergouzi-kaiguan](https://github.com/11dogzi/Comfyui-ergouzi-kaiguan) 